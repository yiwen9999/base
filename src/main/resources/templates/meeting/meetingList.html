<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:include="common :: header"></div>
    <title>会议列表</title>
    <style type="text/css">
        .page_div {
            width: 100%;
            text-align: right;
        }

        .page_btn {
            border-radius: 4px;
            border: 1px solid #e5e9ef;
            background: #fff;
            margin-right: 10px;
            text-align: center;
            width: 38px;
            height: 38px;
            line-height: 8px;
            margin-top: 6px;
            outline: 0;
        }

        .page_btn:hover {
            border: 1px solid #4f90fb;
            color: #4f90fb;
        }
    </style>
</head>
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 会议管理 <span
        class="c-gray en">&gt;</span> 会议列表 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px"
                                              href="javascript:location.replace(location.href);" title="刷新"><i
        class="Hui-iconfont">&#xe68f;</i></a></nav>
<article class="page-container">
    <div class="text-c">
        <input type="text" class="input-text" style="width:250px" placeholder="输入会议名称" id="searchName" name="">
        <button type="submit" class="btn btn-success" id="" name="" onclick="searchMeeting();"><i class="Hui-iconfont">&#xe665;</i>
            搜索
        </button>
    </div>
    <div class="cl pd-5 bg-1 bk-gray mt-20"><span class="l"><a href="javascript:;"
                                                               onclick="meetingAdd('添加会议','/toMeetingAdd','800','500')"
                                                               class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> 添加会议</a></span>
        <span class="r">共有数据：<strong><span id="listNumSpan"></span></strong> 条</span></div>
    <table class="table table-border table-bordered table-hover table-bg">
        <thead>
        <tr>
            <th scope="col" colspan="11">会议列表</th>
        </tr>
        <tr class="text-c">
            <th width="40">序号</th>
            <th width="150">名称</th>
            <th width="90">地址</th>
            <th width="150">日期</th>
            <th width="40">是否抽奖</th>
            <th width="100">状态</th>
            <th width="110">日程</th>
            <th width="110">卫星会</th>
            <th width="70">会议小贴士</th>
            <th width="70">签到列表</th>
            <th width="100">操作</th>
        </tr>
        </thead>
        <tbody id="meetingTbody">
        </tbody>
    </table>
    <div class="page_div">
        <button class="page_btn" id="prePage">上一页</button>
        <button class="page_btn" id="btn1">1</button>
        <span id="prePoint">...</span>
        <button class="page_btn" id="btn2"></button>
        <button class="page_btn" id="btn3"></button>
        <button class="page_btn" id="btn4"></button>
        <button class="page_btn" id="btn5"></button>
        <button class="page_btn" id="btn6"></button>
        <span id="sufPoint">...</span>
        <button class="page_btn" id="btn7"></button>
        <button class="page_btn" id="sufPage">下一页</button>
        <div>
            <input type="hidden" id="meetingIdHidden">
            <div id="meetingStateDiv" style="display: none;">
            </div>
</article>

<div th:include="common :: footer"></div>

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="/lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/lib/laypage/1.2/laypage.js"></script>
<script type="text/javascript" src="/lib/pagination/pagination.js"></script>
<script type="text/javascript">
    var SIZE = 50;//每页显示条数
    var currentPage = 1;//当前页码
    var colorArr = ["#FFFACD", "#98FB98", "#87CEFA"];

    function searchList(page) {
        $.ajax({
            type: "GET",
            url: "/getMeetingStateList",
            dataType: "json",
            success: function (data) {
                if (data.code == "0") {
                    var select = $("<select>").attr("class", "select").attr("id", "meetingStateSelect").css("width", "100px");
                    $.each(data.data, function (index, meetingState) {
                        select.append("<option value=" + meetingState.code + ">" + meetingState.name + "</option>");
                    });
                    $("#meetingStateDiv").append(select);
                } else {
                    alert("获取信息失败");
                }
            }
        });
        page = page || 0;
        $("#meetingTbody").html("");
        $.ajax({
            type: "POST",
            url: "/findMeetingListByCondition",
            data: {
                page: page,
                size: SIZE,
                sortStr: 'name',
                asc: 'asc',
                'name': $('#searchName').val()
            },
            dataType: "json",
            success: function (data) {
                if (data.code == "0") {
                    currentPage = page + 1;
                    $.each(data.data.content, function (index, meeting) {
                        addMeetingTr(index, meeting);
                    });
                    pageCreate(currentPage, data.data.totalPages);
                    $("#listNumSpan").html(data.data.totalElements);
                } else {
                    alert("获取信息失败");
                }
            }
        });
    }

    function addMeetingTr(index, meeting) {
        var tr = $("<tr>").attr("class", "text-c");
        $("#meetingTbody").append(tr);

        var td = $("<td>").html(index + 1);
        tr.append(td);

        td = $("<td>").css("text-align", "left").html(meeting.name);
        tr.append(td);

        td = $("<td>").css("text-align", "left").html(meeting.address);
        tr.append(td);

        td = $("<td>").css("text-align", "left").html(meeting.timeStr);
        tr.append(td);

        td = $("<td>");
        if (meeting.haveLuckyDraw && meeting.haveLuckyDraw === true)
            td.html("是");
        else
            td.html("否");
        tr.append(td);

        td = $("<td>").css("background-color", colorArr[meeting.state]);
        var selectSpan = $("<span class='select-box'>").css("background-color", colorArr[meeting.state]);
        var newSelect = $("#meetingStateSelect").clone().css('width', '100px').css("background-color", colorArr[meeting.state]).change(function () {
            meetingStateChange(meeting.id, this);
        });
        newSelect.find("option[value='" + meeting.state + "']").prop("selected", true)
        td.append(selectSpan.append(newSelect));
        tr.append(td);

        td = $("<td>").attr("class", "td-manage");
        var editA = $("<a>").css("text-decoration", "none").attr("href", "javascript:").attr("title", "列表")
            .click(function () {
                redirectPage('日程列表', '/toScheduleList', meeting.id, '1000', '400');
            });
        var editLi = $("<i>").attr("class", "Hui-iconfont").html("&#xe667;&nbsp;&nbsp;");
        var deleteA = $("<a>").css("text-decoration", "none").attr("href", "javascript:").attr("title", "添加")
            .click(function () {
                redirectPage('添加日程', '/toScheduleAdd', meeting.id, '800', '500');
            });
        var deleteLi = $("<i>").attr("class", "Hui-iconfont").html("&#xe600;&nbsp;&nbsp;");
        td.append(editA.append(editLi)).append(deleteA.append(deleteLi));
        tr.append(td);

        td = $("<td>").attr("class", "td-manage");
        var editA = $("<a>").css("text-decoration", "none").attr("href", "javascript:").attr("title", "列表")
            .click(function () {
                redirectPage('卫星会列表', '/toSatelliteMeetingList', meeting.id, '500', '600');
            });
        var editLi = $("<i>").attr("class", "Hui-iconfont").html("&#xe667;&nbsp;&nbsp;");
        var deleteA = $("<a>").css("text-decoration", "none").attr("href", "javascript:").attr("title", "添加")
            .click(function () {
                redirectFullPage('添加卫星会', '/toSatelliteMeetingAdd', meeting.id, '800', '500');
            });
        var deleteLi = $("<i>").attr("class", "Hui-iconfont").html("&#xe600;&nbsp;&nbsp;");
        td.append(editA.append(editLi)).append(deleteA.append(deleteLi));
        tr.append(td);

        td = $("<td>").attr("class", "td-manage");
        var editA = $("<a>").css("text-decoration", "none").attr("href", "javascript:").attr("title", "添加")
            .click(function () {
                redirectFullPage('会议小贴士', '/toUpdateMeetingTips', meeting.id, '800', '500');
            });
        var editLi = $("<i>").attr("class", "Hui-iconfont").html("&#xe600;");
        if (meeting.tips && meeting.tips != "")
            editLi.html("&#xe6df;");
        td.append(editA.append(editLi));
        tr.append(td);

        td = $("<td>").attr("class", "td-manage");
        var editA = $("<a>").css("text-decoration", "none").attr("href", "javascript:").attr("title", "添加")
            .click(function () {
                redirectFullPage('签到列表', '/toAttendanceListByMeetingId', meeting.id, '800', '500');
            });
        var editLi = $("<i>").attr("class", "Hui-iconfont").html("&#xe665;");
        td.append(editA.append(editLi));
        tr.append(td);

        td = $("<td>").attr("class", "td-manage");
        var infoA = $("<a>").css("text-decoration", "none").attr("href", "javascript:").attr("title", "详情")
            .click(function () {
                redirectPage('详情', '/toMeetingView?meetingId=' + meeting.id, meeting.id, '500', '600');
            });
        var infoLi = $("<i>").attr("class", "Hui-iconfont").html("&#xe665;&nbsp;&nbsp;");
        var editA = $("<a>").css("text-decoration", "none").attr("href", "javascript:").attr("title", "编辑")
            .click(function () {
                redirectPage('会议', '/toMeetingAdd?meetingId=' + meeting.id, meeting.id, '800', '600');
            });
        var editLi = $("<i>").attr("class", "Hui-iconfont").html("&#xe6df;&nbsp;&nbsp;");
        var deleteA = $("<a>").css("text-decoration", "none").attr("href", "javascript:").attr("title", "删除")
            .click(function () {
                meetingDelete(this, meeting.id);
            });
        var deleteLi = $("<i>").attr("class", "Hui-iconfont").html("&#xe6e2;&nbsp;&nbsp;");
        td.append(infoA.append(infoLi)).append(editA.append(editLi)).append(deleteA.append(deleteLi));

        tr.append(td);
    }

    function meetingStateChange(id, object) {
        $.ajax({
            type: 'POST',
            url: '/updateMeetingState',
            data: {
                "meetingId": id,
                "state": object.value
            },
            dataType: 'json',
            success: function (data) {
                if (data.code == "0") {
                    $(object).css("background-color", colorArr[object.value]);
                    $(object).parent().css("background-color", colorArr[object.value]);
                    $(object).parent().parent().css("background-color", colorArr[object.value]);
                    layer.msg('操作成功!', {icon: 1, time: 1000});
                } else {
                    layer.msg(data.msg, {icon: 2, time: 1000});
                }
            }
        });
    }

    $(function () {
        searchList(0);
        pageTurning();
    });

    function meetingDelete(obj, id) {
        layer.confirm('确认要删除吗？', function (index) {
            $.ajax({
                type: 'POST',
                url: '/deleteMeeting',
                data: {
                    "meetingId": id
                },
                dataType: 'json',
                success: function (data) {
                    if (data.code == "0") {
                        $(obj).parents("tr").remove();
                        layer.msg('已删除!', {icon: 1, time: 1000});
                    } else {
                        layer.msg(data.msg, {icon: 2, time: 1000});
                    }
                }
            });
        });
    }

    function meetingAdd(title, url, w, h) {
        $("#meetingIdHidden").val("");
        layer_show(title, url, w, h);
    }

    function redirectPage(title, url, id, w, h) {
        $("#meetingIdHidden").val(id);
        layer_show(title, url, w, h);
    }

    function redirectFullPage(title, url, id, w, h) {
        $("#meetingIdHidden").val(id);
        var index = layer.open({
            type: 2,
            title: title,
            content: url
        });
        layer.full(index);
    }
</script>
</body>
</html>